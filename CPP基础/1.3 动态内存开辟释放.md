## 动态内存开辟释放

​	可以使用关键字new，delete开辟释放内存也可以使用_\<cstdlib>_库文件中的malloc，free函数

### 内存的开辟和初始化

_单个元素_

~~~cpp
int * p1 = new int(20);

int * q1 = (int*)malloc(sizeof(int));
if(p == nullptr)
    return -1;
*p = 20;
~~~

_数组_

~~~cpp
int * p2 = new int[NUMBER];		//数组不进行初始化
int * p3 = new int[NUMBER]();	//数组初始化为0

int * q2 = (int*)malloc(sizeof(int) * NUMBER);
if(p == nullptr)
	return -1;
while(int i =0; i < NUMBER; i++)
{...}	//逐个遍历
~~~

​	malloc开辟内存空间失败就返回nullptr指针
​	new开辟内存失败，抛出bad_alloc类型。检查new应使用异常为非空指针

~~~cpp
try
{
    int * p = new int(20);
}
catch (const bad_alloc & e)
{...}
~~~

###	内存释放

~~~cpp
delete p1;		//new开辟内存单个元素释放
delete []p2;	//new开辟连续内存的释放
delete []p3;

free(q1);		//malloc开辟内存的释放
free(q2);
~~~

​	释放内存时delete和free的区别是free函数不区分单个内存或数组的释放delete需要在加[]。

### new的种类

1. **普通new**

	~~~cpp
	int *p1 = new int(20);
	~~~

2. **不抛出异常new**

	~~~cpp
	int *p2 = new (nothrow) int;
	~~~

	使用此类new在开辟内存空间时，当内存开辟失败不会抛出异常

3. **指向常量new**

	~~~cpp
	const int *p3 = new const int(10);
	~~~

	开辟的内存是常量，开辟是必须初始化，无法更改该内存的值

4. **定位new**

	~~~cpp
	int data;
	int *p4 = new (&data) int(30);
	~~~

	在指定地址开辟空间

	

​	综上，new和malloc的区别：
​		new是c++关键字，malloc是C语言库函数
​		new可以根据数据类型开辟内存并初始化，malloc需要指定大小并手动转化类型
​		new在申请对象的内存时会调用构造函数，在delete时会调用析构函数
